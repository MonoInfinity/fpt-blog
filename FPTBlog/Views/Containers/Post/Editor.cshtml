@using FPTBlog.Src.PostModule.Entity
@using Microsoft.AspNetCore.Html
@section Styles {
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

}


@{
    SelectList categories = (SelectList)this.ViewData["categories"];

    var post = (Post)this.ViewData["post"];
    var content = new HtmlString(post.Content);

    this.ViewData["Title"] = post.Title;
    var previewLink = $"{Routers.PostGetPreview.Link}?postId={post.PostId}";
}

@await Html.PartialAsync("../../Components/Form/FormToastify.cshtml")

<div class="flex-1 px-2 pt-8 pb-16 fade-in ">

    <form class="space-y-4" id="createBlogForm">
        <div class="flex items-center justify-between">

            <h1 class="text-2xl font-semibold">Editor Post</h1>

        </div>

        @if (post.Note != "")
        {
            <div class="space-y-2">
                <h2 class="block font-semibold capitalize">Comment</h2>
                <div class="p-2 border border-red-500 rounded-sm fade-in">

                    <p>
                        @post.Note
                    </p>

                    <p class="mt-2 text-xs text-red-500">
                        This message is created by a lecturer, please change your post and submit again.
                    </p>
                </div>
            </div>
        }


        @await Html.PartialAsync("../../Components/Form/FormHidden.cshtml",
        new {Name="postId", Value=post.PostId})
        @await Html.PartialAsync("../../Components/Form/FormHidden.cshtml",
        new {Name="coverUrl", Value=post.CoverUrl})
        @await Html.PartialAsync("../../Components/Form/TextField.cshtml",
        new {Name="title", Label="Title", Type="text", Value=post.Title})

        <div class="flex space-x-2">
            @await Html.PartialAsync("../../Components/Form/FormDropList.cshtml",
            new {Name="categoryId", Label="Category", Value=post.CategoryId, List=categories})
            @await Html.PartialAsync("../../Components/Form/FormSelectBadge.cshtml",
            new {Name="tag", Label="Tag", Value="", Placeholder ="Enter tag"})
        </div>


        <div class="flex flex-col flex-1 space-y-1">
            <p class="font-semibold">Content</p>

            <div class="">
                <div id="editor" class="flex-1 min-h-120">
                    @content
                </div>
            </div>
        </div>
        <div>
        </div>
        <div class="flex items-center space-x-4">
            @await Html.PartialAsync("../../Components/Form/FormBtn.cshtml",
            new { Label="Save Changes"})

            <a href="@previewLink"
                class="block px-4 py-2 font-medium text-center text-white duration-200 rounded-sm bg-tango-500 hover:bg-tango-600 fade-in"
                onclick="return confirm('Do you save your post, click ok to go to preview page?')" target="_blank">
                Preview
            </a>

            <button id="post-send"
                class="block px-4 py-2 font-medium text-white duration-200 rounded-sm bg-tango-500 fade-in hover:bg-tango-600">
                Submit Post Request
            </button>
        </div>

    </form>
</div>

@section Scripts {
<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<script src="/js/image-resize.min.js"></script>
<script src="/js/post-editor.js"></script>
}
